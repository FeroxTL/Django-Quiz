Можно воспользозваться атомарными транзакциями, которые откатывают все проделанные изменения в бд при возникновении ошибки
